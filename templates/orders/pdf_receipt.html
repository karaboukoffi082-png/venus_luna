<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <style>
        @page { 
            size: A4; 
            margin: 0; /* On gère les marges en interne pour le cadre */
        }
        body { 
            font-family: 'Helvetica', 'Arial', sans-serif; 
            color: #408540ff; 
            line-height: 1.5; 
            margin: 0;
            background-color: #ffffff;
        }
        
        /* Cadre de prestige sur toute la page */
        .page-border {
            border: 15px solid #0a3d2d; /* Vert nuit Venus */
            height: 100%;
            margin: 0;
            padding: 40px;
            box-sizing: border-box;
        }

        .inner-border {
            border: 1px solid #d4af37; /* Liseré doré */
            height: 100%;
            padding: 30px;
            position: relative;
        }

        .header { text-align: center; margin-bottom: 40px; }
        .shop-name { 
            font-size: 32px; 
            color: #0a3d2d; 
            font-weight: bold; 
            letter-spacing: 5px; 
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .gold-divider {
            height: 2px;
            width: 100px;
            background-color: #d4af37;
            margin: 10px auto;
        }
        .receipt-title { font-size: 12px; text-transform: uppercase; color: #888; letter-spacing: 2px; }
        
        .details-container { margin-bottom: 40px; width: 100%; }
        .details-table { width: 100%; border: none; }
        .details-table td { vertical-align: top; border: none; padding: 0; }

        .client-info { font-size: 13px; color: #444; }
        .order-info { text-align: right; font-size: 13px; }
        .label { color: #d4af37; font-weight: bold; text-transform: uppercase; font-size: 10px; display: block; margin-bottom: 3px; }

        table.items-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        table.items-table th { 
            border-bottom: 2px solid #d4af37; 
            padding: 12px; 
            text-align: left; 
            font-size: 11px; 
            text-transform: uppercase; 
            color: #0a3d2d;
            background-color: #fcfaf5;
        }
        table.items-table td { border-bottom: 1px solid #eee; padding: 15px 12px; font-size: 13px; }
        
        .summary-wrapper { margin-top: 30px; }
        .summary-table { width: 220px; margin-left: auto; }
        .summary-table td { padding: 6px 0; font-size: 13px; }
        .total-row { 
            font-size: 18px; 
            color: #0a3d2d; 
            font-weight: bold; 
            border-top: 2px solid #d4af37;
        }

        .status-stamp {
            position: absolute;
            top: 150px;
            right: 50px;
            border: 3px solid #28a745;
            color: #28a745;
            padding: 10px 20px;
            font-weight: bold;
            text-transform: uppercase;
            transform: rotate(-15deg);
            opacity: 0.2;
            border-radius: 10px;
            font-size: 24px;
        }

        .footer { 
            position: absolute;
            bottom: 30px;
            left: 30px;
            right: 30px;
            text-align: center; 
            font-size: 10px; 
            color: #999; 
        }
    </style>
</head>
<body>
    <div class="page-border">
        <div class="inner-border">
            
            <div class="status-stamp">PAIEMENT VALIDÉ</div>

            <div class="header">
                <div class="shop-name">VENUS LUNA</div>
                <div class="gold-divider"></div>
                <div class="receipt-title">Reçu Officiel de Transaction</div>
            </div>

            <table class="details-table">
                <tr>
                    <td class="client-info">
                        <span class="label">Destinataire</span>
                        <strong style="font-size: 16px; color: #0a3d2d;">{{ order.shipping_address.full_name }}</strong><br>
                        {{ order.shipping_address.phone }}<br>
                        {{ order.shipping_address.address }}<br>
                        {{ order.shipping_address.city }}, Togo
                    </td>
                    <td class="order-info">
                        <span class="label">Détails de commande</span>
                        <strong>Référence :</strong> #{{ order.id }}<br>
                        <strong>Date :</strong> {{ order.created_at|date:"d F Y" }}<br>
                        <strong>Méthode :</strong> Mobile Money (BKAPAY)
                    </td>
                </tr>
            </table>

            <table class="items-table">
                <thead>
                    <tr>
                        <th width="50%">Désignation du Trésor</th>
                        <th style="text-align: center;">Qté</th>
                        <th style="text-align: right;">Prix Unitaire</th>
                        <th style="text-align: right;">Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in order.items.all %}
                    <tr>
                        <td><strong>{{ item.name }}</strong></td>
                        <td style="text-align: center;">{{ item.quantity }}</td>
                        <td style="text-align: right;">{{ item.price }} F</td>
                        <td style="text-align: right;">{{ item.line_total }} F</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <div class="summary-wrapper">
                <table class="summary-table">
                    <tr>
                        <td>Sous-total :</td>
                        <td style="text-align: right;">{{ order.subtotal }} F</td>
                    </tr>
                    <tr>
                        <td>Frais de livraison :</td>
                        <td style="text-align: right;">{{ order.shipping_price|default:"0" }} F</td>
                    </tr>
                    <tr class="total-row">
                        <td style="padding-top: 15px;">TOTAL :</td>
                        <td style="text-align: right; padding-top: 15px;">{{ order.total }} FCFA</td>
                    </tr>
                </table>
            </div>

            <div style="margin-top: 50px; font-style: italic; font-size: 12px; color: #666; text-align: center;">
                "Que ces objets vous accompagnent vers une sérénité profonde."
            </div>

            <div class="footer">
                <p>Boutique VENUS LUNA - Adidoadin, Lomé, Togo</p>
                <p>RC N° 228-LOM-202X-B-XXXX | Tel: +228 93 34 34 03</p>
                <p style="margin-top: 10px; color: #d4af37;">Document généré numériquement - Valable sans signature.</p>
            </div>

        </div>
    </div>
</body>
</html>