{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    :root {
        --venus-vert: #145c44;
        --venus-vert-profond: #0a2e22;
        --venus-or: #d4af37;
        --venus-jaune: #fbc02d;
    }

    .cart-section {
        background: radial-gradient(circle at top, var(--venus-vert), var(--venus-vert-profond));
        min-height: 85vh;
        color: white;
    }

    .glass-panel {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(15px);
        border: 1px solid rgba(212, 175, 55, 0.2);
        border-radius: 30px;
        box-shadow: 0 25px 50px rgba(0,0,0,0.3);
    }

    .table-dark {
        --bs-table-bg: transparent;
        --bs-table-color: #f8f9fa;
    }

    .product-img-cart {
        width: 70px;
        height: 70px;
        object-fit: cover;
        border-radius: 15px;
        border: 1px solid var(--venus-or);
        transition: 0.3s;
    }

    .product-img-cart:hover {
        transform: scale(1.1) rotate(3deg);
    }

    /* Style des inputs de quantité */
    .qty-input {
        background: rgba(0, 0, 0, 0.3) !important;
        color: var(--venus-jaune) !important;
        border: 1px solid rgba(212, 175, 55, 0.3) !important;
        border-radius: 10px;
        font-weight: bold;
    }

    .btn-checkout {
        background: linear-gradient(45deg, var(--venus-or), var(--venus-jaune));
        color: var(--venus-vert-profond) !important;
        border: none;
        border-radius: 15px;
        letter-spacing: 1px;
        text-transform: uppercase;
        transition: 0.4s;
    }

    .btn-checkout:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(212, 175, 55, 0.3);
        filter: brightness(1.1);
    }

    .trash-icon {
        color: rgba(255, 255, 255, 0.3);
        transition: 0.3s;
    }

    .trash-icon:hover {
        color: #ff4d4d;
        transform: scale(1.2);
    }

    .payment-badge {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 0.75rem;
        padding: 8px 15px;
        border-radius: 10px;
        color: var(--venus-jaune);
    }
</style>

<section class="cart-section py-5">
    <div class="container py-4">
        <header class="text-center mb-5">
            <h1 class="display-4 fw-bold mb-2" style="font-family: 'Playfair Display', serif; color: white;">Votre Panier</h1>
            <div style="height: 3px; width: 60px; background: var(--venus-or); margin: 0 auto;"></div>
            <p class="text-white-50 mt-3 small text-uppercase ls-2">Préparation de votre éveil spirituel</p>
        </header>

        {% if cart_items %}
        <div class="row g-5">
            <div class="col-lg-8">
                <div class="glass-panel p-2">
                    <div class="table-responsive">
                        <table class="table table-dark align-middle mb-0">
                            <thead>
                                <tr class="text-gold-light opacity-75 small text-uppercase">
                                    <th class="ps-4 py-4 border-0">Trésor</th>
                                    <th class="py-4 border-0">Prix</th>
                                    <th class="py-4 border-0 text-center">Quantité</th>
                                    <th class="py-4 border-0">Total</th>
                                    <th class="py-4 border-0 text-center"></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in cart_items %}
                                <tr>
                                    <td class="ps-4">
                                        <div class="d-flex align-items-center py-3">
                                            {% if item.product.images.all %}
                                                <img src="{{ item.product.images.first.image.url }}" class="product-img-cart me-3 shadow">
                                            {% else %}
                                                <div class="product-img-cart me-3 d-flex align-items-center justify-content-center bg-dark"></div>
                                            {% endif %}
                                            <div>
                                                <h6 class="mb-0 fw-bold">{{ item.name }}</h6>
                                                <small class="text-white-50">Lomé, Togo</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>{{ item.price }} <small>F</small></td>
                                    <td style="width: 120px;">
                                        <form action="{% url 'orders:cart_update' item.product.id %}" method="post">
                                            {% csrf_token %}
                                            <input type="number" name="quantity" value="{{ item.quantity }}" min="1" 
                                                   class="form-control form-control-sm qty-input text-center mx-auto" 
                                                   onchange="this.form.submit()">
                                        </form>
                                    </td>
                                    <td class="fw-bold text-gold">{{ item.subtotal }} <small>F</small></td>
                                    <td class="text-center">
                                        <a href="{% url 'orders:cart_remove' item.product.id %}" class="trash-icon">
                                            <i class="far fa-trash-alt"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="mt-4 ms-2">
                    <a href="{% url 'products:list' %}" class="text-decoration-none text-gold small fw-bold">
                        <i class="fas fa-long-arrow-alt-left me-2"></i> CONTINUER MES ACHATS
                    </a>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="glass-panel p-4">
                    <h4 class="mb-4 text-gold fw-bold" style="font-family: 'Playfair Display';">Sommaire</h4>
                    
                    <div class="d-flex justify-content-between mb-3">
                        <span class="opacity-75">Sous-total</span>
                        <span class="fw-bold">{{ cart_total }} F</span>
                    </div>
                    
                    <div class="d-flex justify-content-between mb-3">
                        <span class="opacity-75">Livraison (Lomé)</span>
                        <span class="text-success small">À confirmer</span>
                    </div>

                    <hr class="border-white border-opacity-10 my-4">

                    <div class="d-flex justify-content-between mb-4 align-items-end">
                        <span class="h5 mb-0">Total</span>
                        <div class="text-end">
                            <span class="h3 fw-bold text-gold d-block mb-0">{{ cart_total }} F</span>
                            <small class="text-white-50 x-small">TVA incluse</small>
                        </div>
                    </div>

                    <a href="{% url 'orders:checkout' %}" class="btn btn-checkout w-100 py-3 fw-bold mb-4">
                        Finaliser la commande <i class="fas fa-magic ms-2"></i>
                    </a>

                    <div class="text-center">
                        <p class="x-small text-white-50 mb-3">Modes de paiement acceptés au Togo :</p>
                        <div class="d-flex justify-content-center gap-2">
                            <span class="payment-badge">T-Money</span>
                            <span class="payment-badge">Moov Money</span>
                        </div>
                        <div class="mt-3">
                            <i class="fas fa-shield-alt text-success me-2"></i><small class="x-small text-white-50">Transactions sécurisées</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="glass-panel py-5 text-center">
                    <div class="mb-4">
                        <i class="fas fa-moon fa-4x text-gold opacity-25"></i>
                    </div>
                    <h3 class="mb-3">Votre panier est vide</h3>
                    <p class="text-white-50 mb-5 px-4">L'univers attend que vous choisissiez les outils de votre voyage intérieur.</p>
                    <a href="{% url 'products:list' %}" class="btn btn-checkout px-5 py-2">Découvrir la boutique</a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}